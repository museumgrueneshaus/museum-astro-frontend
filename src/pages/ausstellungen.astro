---
import Layout from '../layouts/Layout.astro';
import '../styles/grid.css';
import GalleryCard from '../components/GalleryCard.astro';
import { getAusstellungen, urlFor } from '../lib/sanity';

let ausstellungen = [];
try {
  const exps = await getAusstellungen({ aktiv: true });
  ausstellungen = exps.map((a) => ({
    id: a._id,
    title: a.titel,
    subtitle: a.untertitel || a.zeitraum?.zeitraum_text || '',
    image: a.titelbild ? urlFor(a.titelbild).width(1600).height(undefined).auto('format').url() : '/placeholder.jpg',
    slug: a.slug?.current || a._id,
    ratio: '3 / 2',
    featured: a.ist_featured,
    typ: a.zeitraum?.typ,
    exponatCount: a.exponatCount || 0,
  }));
} catch {}
---

<Layout title="Ausstellungen" theme="light">
  <main class="blank">
    <section class="container">
      <h1 class="page-title">Ausstellungen</h1>

      {ausstellungen.length > 0 ? (
        <div class="gallery-grid">
          {ausstellungen.map((a) => (
            <div class="gitem" data-id={a.id} data-featured={a.featured}>
              <GalleryCard
                title={a.title}
                subtitle={a.subtitle}
                image={a.image}
                href={`/ausstellung/${a.slug}`}
                ratio={a.ratio}
              />
              {a.featured && (
                <div class="featured-marker">★ Highlight</div>
              )}
              {a.exponatCount > 0 && (
                <div class="exponat-count">{a.exponatCount} Exponate</div>
              )}
            </div>
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <p>Aktuell sind keine Ausstellungen verfügbar.</p>
        </div>
      )}
    </section>
  </main>

  <style>
    .blank {
      min-height: 100vh;
      width: 100vw;
      background: var(--bg);
      padding: var(--space-4) 0 var(--space-8);
      overflow-x: hidden;
    }

    .page-title {
      font-size: 48px !important;
      font-weight: 900 !important;
      margin-bottom: var(--space-6);
      color: var(--text);
    }

    .gallery-grid {
      margin-top: var(--space-4);
      display: grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 40px;
    }

    @media (min-width: 900px) {
      .gallery-grid {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
    }

    @media (min-width: 1280px) {
      .gallery-grid {
        grid-template-columns: repeat(3, minmax(0,1fr));
      }
    }

    .gitem {
      position: relative;
    }

    .featured-marker {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(255, 215, 0, 0.95);
      backdrop-filter: blur(8px);
      color: #000;
      padding: 6px 12px;
      font-size: 14px !important;
      font-weight: 700 !important;
      z-index: 10;
      pointer-events: none;
    }

    .exponat-count {
      margin-top: 4px;
      font-size: 14px !important;
      color: var(--text-dim);
      opacity: 0.8;
    }

    .empty-state {
      text-align: center;
      padding: var(--space-8);
      color: var(--text-dim);
      font-size: 18px !important;
    }
  </style>
</Layout>
